# -*- coding:utf-8 -*-# auth scott# 读取trp首行记录的时间设置为wmv文件的mt时间import sys,os,os.path,time,struct,traceback,threading,datetimedef readImageTimes(imagefile,ffmpeg='ffmpeg.exe'):	import re	rst = () # (creattime,lastmodifytime) timestamp time ticks	imagefile = os.path.normpath(imagefile)	detail = os.popen3('c:/dvr_bin/ffmpeg.exe -i %s'%(imagefile) )[2].read()	tt = re.findall('Duration: (\d{1,2}:\d{1,2}:\d{1,2}\.\d{0,4}),',detail,re.M)	if tt:		tt = tt[0]	else:		return ()	h,m,s = map(int, map(float,tt.split(':')) )	duration_secs =  int ( h*3600 + m * 60 + s)	return duration_secsdef setmtime(file,tick): # tick - unix timestamp 1970~	os.utime(file,(tick,tick) )def synctime(d):	files = os.listdir(d)	for file in files:		name,ext = os.path.splitext(file)		if ext.lower() == '.trp':			fd = open(os.path.join(d,file))			line = fd.readline()			fd.close()			tick = line.split(',')[3]			wmv = os.path.join(d,name+".wmv")			if os.path.exists(wmv):				dr = readImageTimes(wmv)				setmtime(wmv,int(tick)+dr-1 )if __name__=='__main__':	synctime(sys.argv[1])