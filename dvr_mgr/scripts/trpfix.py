# -*- coding:utf-8 -*-#patch1  #dvr导出trp数据后期处理#去掉 速度 属性 ；补充缺失的gps点；剔除重复点;去除飞点import sys,os,os.path,time,struct,traceback,threading,datetime,copycvtcmd='''avi2wmv\\ffmpeg.exe -r 15 -i %s -b 3000k -r 15  %s'''clips_dir='20111201'clips_dest='trp_new'#是否落在中国区间界内def checkpoint(ll):	return True#ymd hms >> unix timestampdef ticktime(strtime):	return 0#timestramp >> ymd hmsdef maketime(tick):	return ''#清除gps为0的trp和avi文件def cleanfile(dir,file):	size = os.path.getsize("%s/%s"%(dir,file))	if size==0:		os.remove("%s/%s"%(dir,file)		base,ext = os.path.splitext(file)		os.remove("%s/%s.avi"%(dir,base)	files = os.listdir(clips_dir)for file in files:	name,ext = os.path.splitext(file)	if ext.lower() == '.trp':		#check wmv is existed?		cleanfile(clips_dir,file)		ff = open("%s/%s"%(clips_dir,file),'r')		lines = ff.readlines()		ff.close()		ff = open("%s/%s"%(clips_dest,file),'w')		hash={}		#重复时间的轨迹点		for line in lines:			pp = line.strip().split(',')			hask[pp[2]] = pp	#令所有记录时间唯一						#k = "%s,%s,%s\n"%(pp[1],pp[0],pp[2])		#飞点过滤		ticks = hash.keys().sort()		path =[]		for n in range(len(ticks)):			tick = ticks[n]			d = hash[tick]			if not checkpoint( d[0:2]):				continue						path.push(d)						#判断是否飞点						#补点			if n != len(ticks)-1: 								t1 = ticktime(tick)								t2 = ticktime(ticks[n+1])				dis = t2-t1				for n in range(1,dis):					#复制上一条有效gps记录					d2 = copy.deepcopy(d)					d2[2] = maketime(t2+n)					ticks2.push(d2)					dis-=1		for p in path:				k = "%s,%s,%s\n"%(p[0],p[1],p[2])			ff.write(k)		ff.close()		