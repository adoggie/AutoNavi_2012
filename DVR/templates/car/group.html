<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>车辆分组</title>
<STYLE type=text/css> 
{
	FONT-SIZE: 12px
}
.gridView {
	BORDER-RIGHT: #bad6ec 1px; BORDER-TOP: #bad6ec 1px; BORDER  -LEFT: #bad6ec 1px; COLOR: #566984; BORDER-BOTTOM: #bad6ec 1px; FONT-FAMILY: Courier New
}
.gridViewHeader {
	BORDER-RIGHT: #bad6ec 1px solid; BORDER-TOP: #bad6ec 1px solid; BACKGROUND-IMAGE: url(/static/imgs/images/bg_th.gif); BORDER-LEFT: #bad6ec 1px solid; LINE-HEIGHT: 27px; BORDER-BOTTOM: #bad6ec 1px solid
}
.gridViewItem {
	BORDER-RIGHT: #bad6ec 1px solid; BORDER-TOP: #bad6ec 1px solid; BORDER-LEFT: #bad6ec 1px solid; LINE-HEIGHT: 32px; BORDER-BOTTOM: #bad6ec 1px solid; TEXT-ALIGN: left
}
.cmdField {
	BORDER-RIGHT: 0px; BORDER-TOP: 0px; BACKGROUND-IMAGE: url(/static/imgs/bg_rectbtn.png); OVERFLOW: hidden; BORDER-LEFT: 0px; WIDTH: 67px; COLOR: #364c6d; LINE-HEIGHT: 27px; BORDER-BOTTOM: 0px; BACKGROUND-REPEAT: repeat-x; HEIGHT: 27px; BACKGROUND-COLOR: transparent; TEXT-DECORATION: none
}
.buttonBlue {
	BORDER-RIGHT: 0px; BORDER-TOP: 0px; BACKGROUND-IMAGE: url(/static/imgs/bg_button_blue.gif); BORDER-LEFT: 0px; WIDTH: 78px; COLOR: white; BORDER-BOTTOM: 0px; BACKGROUND-REPEAT: no-repeat; HEIGHT: 21px
}
</STYLE>
<META content="MSHTML 6.00.2900.5848" name=GENERATOR>
</HEAD>

<BODY 
style="BACKGROUND-POSITION-Y: -120px; BACKGROUND-IMAGE: url(/static/imgs/bg.gif); BACKGROUND-REPEAT: repeat-x">
<form name="form1" method="post" action=""> {% csrf_token %}

<DIV>

  <TABLE height="100%" cellSpacing=0 cellPadding=0 width="100%" border=0>
    <TBODY>
      <TR 
  style="BACKGROUND-IMAGE: url(/static/imgs/bg_header.gif); BACKGROUND-REPEAT: repeat-x" 
  height=47>
       <!-- <TD width="10"><SPAN 
      style="FLOAT: left; BACKGROUND-IMAGE: url(/static/imgs/main_hl.gif); WIDTH: 15px; BACKGROUND-REPEAT: no-repeat; HEIGHT: 47px"></SPAN></TD>-->
        <TD><SPAN 
      style="FLOAT: left; BACKGROUND-IMAGE: url(/static/imgs/main_hl2.gif); WIDTH: 15px; BACKGROUND-REPEAT: no-repeat; HEIGHT: 47px"></SPAN><SPAN 
      style="PADDING-RIGHT: 10px; PADDING-LEFT: 10px; FLOAT: left; BACKGROUND-IMAGE: url(/static/imgs/main_hb.gif); PADDING-BOTTOM: 10px; COLOR: white; PADDING-TOP: 10px; BACKGROUND-REPEAT: repeat-x; HEIGHT: 47px; TEXT-ALIGN: center; 0px: ">策略分组 </SPAN><SPAN 
      style="FLOAT: left; BACKGROUND-IMAGE: url(/static/imgs/main_hr.gif); WIDTH: 60px; BACKGROUND-REPEAT: no-repeat; HEIGHT: 47px"></SPAN></TD>
        <TD 
    style="BACKGROUND-POSITION: 50% bottom; BACKGROUND-IMAGE: url(file" 
    width=10></TD>
      </TR>
      <TR>
       <!-- <TD style="BACKGROUND-IMAGE: url(file">&nbsp;</TD>-->
        <TD 
    style="PADDING-RIGHT: 10px; PADDING-LEFT: 10px; PADDING-BOTTOM: 10px; COLOR: #566984; PADDING-TOP: 10px; BACKGROUND-COLOR: white" 
    vAlign=top align=middle>
          <DIV>
		  <table width="100%" align="center" border="0" cellspacing="0" cellpadding="0" style="border: 1px solid #C2E1F4;">
            <tr>
              <td align="center">组名称:&nbsp;&nbsp;
              {% if form.instance.id %}
                {{form.name}} &nbsp;&nbsp; <input type="button" id="edit" name="save" value="修改" /></td>
                <input type="hidden"  id="id" name='id' value={{form.instance.id}} />
              {% else %}
                {{form.name}} &nbsp;&nbsp; <input type="button" id="save" name="save" value="添加" /></td> 
              {% endif %}
              </tr>
          </table>
		  <br/>
		  <table align="center" border="0" width="600px"  >
				<tr>
					<td height="25" colSpan="3" >&nbsp;请选择分组&gt;&gt;</td>
	            </tr>
				<tr>
					<td width="250px" align="center">
                         
                      组名:
						<select style="width:150px" class="group"  id="groups1" onchange="getVehicleOptions(this.value,'groups1')">
						<option value ="0">未分组</option>
						{% for group in groups %}
						  <option value ="{{group.id}}">{{group}}</option>
						 {% endfor %}
						</select>
                    </td>
					<td >&nbsp;</td>
					<td width="250px"> 
                   组名:
                        <select style="width:150px" class="group"  id="groups2" onchange="getVehicleOptions(this.value,'groups2')">
                        <option value ="0">未分组</option>
                        {% for group in groups %}
                          <option value ="{{group.id}}">{{group}}</option>
                         {% endfor %}
                        </select>
                     </td>
				</tr>
				<tr>
					<td align="center" height="260"  >
					<select multiple="multiple" size="10" class="vehicles" id="vehicles1"  style="width:150px;height:200px" >
					{% for group in vehicles %}
					  <option value ="{{group.id}}">{{group}}</option>
					 {% endfor %}
					</select>
					  <br />
                  </td>
					<td align="center">
					 <input type="button" value=">>" name="button1" id="button1"/>
                     
						<br />
                        <br />
                        <br />
                        <input type="button" value="<<" name="button2" id="button2" /><br />
                        
                  </td>
				  <td align="center">
				  <select multiple="multiple" size="10" class="vehicles" id="vehicles2"  style="width:150px;height:200px" >
					{% for group in vehicles %}
					  <option value ="{{group.id}}">{{group}}</option>
					 {% endfor %}
					</select>                
				   </td>
				</tr>
				<tr>
	  </tr>
	</table>
          </DIV>
        </TD>
        <TD style="BACKGROUND-IMAGE: url(file"></TD>
      </TR>
      <TR 
  style="BACKGROUND-IMAGE: url(/static/imgs/main_fs.gif); BACKGROUND-REPEAT: repeat-x" 
  height=10>
      </TR>
    </TBODY>
  </TABLE>
</DIV>

 </form>
 
<script type="text/javascript" src="/static/js/jquery-1.3.1.js"></script>
<script type="text/javascript">
//获取要移动的车辆id
function getIDs(vehicles){
    var s ="";
    $(vehicles).find("option:selected").each(function(){
        s += $(this).val()+","
    })
    if(s!=""){
        s = s.substr(0,s.length-1);
        return s
    }else{
        alert("请选择要移动的车辆")
        return false
    }
}

function reloadVehicles(vehicleSelect,vehicles){
    // 清空下拉框
    vehicleSelect.empty()
    // 创建select选项
    $(vehicles).each(function(i){
        vehicle = vehicles[i];
        vehicleSelect.append("<option value='" + vehicle.pk + "'>" + vehicle.fields.name + "</option>" );
    })
}

$(function(){
    $("#button1,#button2").click(function(){
        button = $(this).attr("name")
         if(!$("#groups1").val()){
             alert("请选择组车辆组！");
             return false;
         }
         if (!$("#groups2").val()) {
             alert("请选择组车辆组！");
             return false;
         }
         if ($("#groups1").val() == $("#groups2").val()) {
             alert("两个组不能相同！");
             return false;
         }
         if(button=="button1"){
             ids = getIDs("#vehicles1")
         }else{
             ids = getIDs("#vehicles2")
         }
         $.post("/device/change_vehicles_group_r/", {
             groups1:$("#groups1").val(),
             groups2:$("#groups2").val(),
             ids: ids,
             button:button,
             csrfmiddlewaretoken:$("[name=csrfmiddlewaretoken]").val(),
             },function(data,textStatus){
                 var vehicles1 = data.vehicles1
                 var vehicles1Select = $("#vehicles1");
                 reloadVehicles(vehicles1Select,vehicles1);
                 
                 var vehicles2 = data.vehicles2
                 var vehicles2Select = $("#vehicles2");
                 reloadVehicles(vehicles2Select,vehicles2);
             },"json"
         );
    })
    $("#save").click(function(){
        url="/device/vehicle/group/add/"
        
        $.post(url,{
            name:$("#id_name").val(),
            csrfmiddlewaretoken:$("[name=csrfmiddlewaretoken]").val(),
        },function(data){
        	if(data=="1"){
        		alert("车辆组添加成功")
        	}else{
        		 alert("车辆组添加失败");
        	}
            location.reload();
        });
    })
    $("#edit").click(function(){
        url="/device/vehicle/group/add/"
        $.post(url,{
            name:$("#id_name").val(),
            id:$("#id").val(),
            csrfmiddlewaretoken:$("[name=csrfmiddlewaretoken]").val(),
        },function(data){
            if(data=="1"){
                alert("车辆组修改成功")
            }else{
                 alert("车辆组修改失败");
            }
            location.reload();
        });
    })
 })
function getVehicleOptions(value,groups){
        var url = "/device/vehicles/"+value+"/"
        $.getJSON(url, function(json){
            //从服务器取得的车辆集
            var vehicles = json.vehicles
            //要操作的select
            var vehicleSelect;
            if(groups=="groups1"){
                vehicleSelect = $("#vehicles1");
            }else if(groups=="groups2"){
                vehicleSelect = $("#vehicles2");
            }
            reloadVehicles(vehicleSelect,vehicles)
        });
    }
</script>
</BODY>

</HTML>


